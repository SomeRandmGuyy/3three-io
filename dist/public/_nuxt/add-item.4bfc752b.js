import G from"./ArgonButton.a79d4a57.js";import W from"./ArgonInput.8d0576a6.js";import X from"./ArgonRadio.e49aefcd.js";import Z from"./ArgonSwitch.8ac71057.js";import{y as ee,P as te,Q as U,K as E,R as L,S as se,o as l,b as d,e as o,T as O,u as e,c as oe,w as g,i as I,l as m,t as _,a7 as M,a8 as R,F as B,k as N,h as y,U as D}from"./entry.6e39450e.js";import{C as F}from"./choices.553387e5.js";import{u as ae}from"./ItemStore.9ee858b8.js";import{u as ne}from"./TagStore.0779537d.js";import{u as re}from"./CategoryStore.cfacd2c0.js";import{u as ie,c as H,r as q}from"./index.c39e5092.js";import{Q as le}from"./vue-quill.esm-bundler.bc216698.js";import{i as f,g as V,c as me}from"./errorHandler.790c67ca.js";import{J as de}from"./index.aad0ddd6.js";import{d as b}from"./default_avatar.3b6e3719.js";import"./tslib.es6.4057be70.js";const ue=()=>{let S=new Date;return new Date(S.getTime()-S.getTimezoneOffset()*6e4).toISOString().split("T")[0]},ce={class:"card shadow-lg mx-4 p-3 mt-4"},pe={class:"d-flex justify-content-between px-4 pt-3"},ge=o("h5",{class:"font-weight-bolder mb-0"},"Add Item",-1),_e=o("span",{class:"btn-inner--text"},"Back to list",-1),fe=[_e],he={class:"mt-4"},ve={class:"d-flex flex-column max-content align-items-center mb-4 mx-4"},be=["src"],ye={class:"mt-2 d-flex justify-content-center"},xe=o("span",null,[o("i",{class:"fa fa-times"}),y(" Remove ")],-1),we={for:"imageInput",class:"mb-0"},Ie={key:0,style:{color:"#fd5c70",margin:"5px","font-size":"12px"}},Ve={class:"col-12 mt-sm-0"},Se=o("label",null,"Name",-1),Te={class:"col-12 mt-sm-0"},Ce=o("label",null,"Description",-1),$e={key:0,style:{color:"#fd5c70","margin-left":"5px","font-size":"12px"}},ke={class:"col-12 mt-3"},Ae=o("label",null,"Category",-1),Ue=["value"],Oe={class:"col-12 mt-3"},De=o("label",null,"Tags",-1),Ee=["value"],Le={key:0,style:{color:"#fd5c70","margin-left":"5px","font-size":"12px"}},Me={class:"col-12 mt-3"},Re=o("label",null,"Status",-1),Be={class:"col-12 mt-3"},Ne=o("label",null,"Show on homepage?",-1),Fe={class:"col-2 mt-3"},He=o("label",null,"Date",-1),qe={class:"button-row d-flex mt-4"},at={__name:"add-item",async setup(S){let u,c;ee(()=>{z("choices-category"),J("choices-tags")});const z=r=>{const t=document.getElementById(r);if(t)return new F(t,{searchEnabled:!1})},J=r=>{const t=document.getElementById(r);if(t)return new F(t,{removeItemButton:!0})},T=te(),h=ae(),C=ne(),$=re();[u,c]=U(()=>h.getAllItemsList()),await u,c(),[u,c]=U(()=>C.getAllTagsList()),await u,c(),[u,c]=U(()=>$.getAllCategoriesList()),await u,c();const p=E(b),k=E(null),a=L({name:"",description:"",category:$.allCategoriesList[0].id,tags:[C.allTagsList[0].id],status:"published",isOnHomepage:!1,date:ue()}),n=L([]),j=async()=>{const r=k.value.files;if(!r.length)return;const t=new FileReader;t.readAsDataURL(r[0]),t.onload=()=>{p.value=t.result}},Q=()=>{p.value=b},P=se(()=>({name:{required:H.withMessage("The name field is required",q)},description:{required:H.withMessage("The description field is required",q)}})),A=ie(P,a),K=async()=>{if(n.value=[],A.value.$validate(),Y(),A.value.$error||n.value.length){const r=JSON.parse(JSON.stringify(A.value.$errors));n.value=[...n.value,...r]}else try{const r=await h.createItem({name:a.name,description:a.description,status:a.status,date:a.date,isOnHomepage:a.isOnHomepage,category:a.category,tags:a.tags});if(r.error.value){const t=r.error.value.data.errors[0].detail;throw new Error(t)}else if(p.value===b)D("success","Item created successfuly"),T.push({path:"/examples/item-management/list-items"});else{const i=new de().deserialize(r.data.value),x=await h.uploadItemImage(k,i.id),v=i.tags.map(s=>s.id),w=await h.updateItem({itemId:i.id,image:x,tags:v,name:i.name,description:i.description,status:i.status,isOnHomepage:i.is_on_homepage,date:i.date_at,category:i.category.id});if(w.error.value){const s=w.error.value.data.errors[0].detail;throw new Error(s)}else D("success","Item created successfuly"),T.push({path:"/examples/item-management/list-items"})}}catch(r){D("error",r.message)}},Y=()=>{me(a.name,h.allItemsList)&&(n.value=[...n.value,{$property:"name",$message:"The Item with this name already exists."}]),a.description==="<p><br></p>"&&(n.value=[...n.value,{$property:"description",$message:"The description field is required"}]),a.tags.length||(n.value=[...n.value,{$property:"tags",$message:"You should choose at least one tag."}])};return(r,t)=>{const i=G,x=W,v=X,w=Z;return l(),d("div",ce,[o("div",pe,[ge,o("button",{onClick:t[0]||(t[0]=O(s=>e(T).push({path:"/examples/item-management/list-items"}),["prevent"])),type:"button",class:"btn base-button btn-icon btn-fab btn-primary btn-sm"},fe)]),o("div",he,[o("form",{role:"form",onSubmit:O(K,["prevent"])},[o("div",ve,[o("img",{src:e(p),class:"rounded d-flex justify-content-center argon-image",width:"200",height:"200"},null,8,be),o("div",ye,[e(p)!==e(b)?(l(),oe(i,{key:0,type:"button",onClick:t[1]||(t[1]=O(s=>Q(),["prevent"])),class:"btn base-button btn btn-sm btn-danger btn-button mx-2"},{default:g(()=>[xe]),_:1})):I("",!0),m(i,{type:"button",class:"btn base-button btn btn-sm btn-primary btn-button"},{default:g(()=>[o("label",we,_(e(p)!==e(b)?"Change":"Select image"),1),o("input",{ref_key:"file",ref:k,id:"imageInput",accept:"image/*",type:"file",style:{display:"none"},onChange:t[2]||(t[2]=s=>j())},null,544)]),_:1})]),e(f)("image",e(n))?(l(),d("span",Ie,_(e(V)("image",e(n))),1)):I("",!0)]),o("div",Ve,[Se,m(x,{id:"name",name:"name",class:"multisteps-form__input",type:"text",placeholder:"Item Name",modelValue:e(a).name,"onUpdate:modelValue":t[3]||(t[3]=s=>e(a).name=s),error:e(f)("name",e(n)),errorMessage:e(V)("name",e(n))},null,8,["modelValue","error","errorMessage"])]),o("div",Te,[Ce,m(e(le),{id:"description",name:"description",class:"multisteps-form__input",contentType:"html",content:e(a).description,"onUpdate:content":t[4]||(t[4]=s=>e(a).description=s),"aria-errormessage":e(f)("description",e(n)),error:e(f)("description",e(n)),style:{"min-height":"150px"}},null,8,["content","aria-errormessage","error"]),e(f)("description",e(n))?(l(),d("span",$e,_(e(V)("description",e(n))),1)):I("",!0)]),o("div",ke,[Ae,M(o("select",{id:"choices-category",class:"form-control",name:"choices-category","onUpdate:modelValue":t[5]||(t[5]=s=>e(a).category=s)},[(l(!0),d(B,null,N(e($).allCategoriesList,s=>(l(),d("option",{value:s.id},_(s.name),9,Ue))),256))],512),[[R,e(a).category]])]),o("div",Oe,[De,M(o("select",{id:"choices-tags",style:{"margin-bottom":"0px"},name:"choices-tags",multiple:"","onUpdate:modelValue":t[6]||(t[6]=s=>e(a).tags=s)},[(l(!0),d(B,null,N(e(C).allTagsList,s=>(l(),d("option",{value:s.id},_(s.name),9,Ee))),256))],512),[[R,e(a).tags]]),e(f)("tags",e(n))?(l(),d("span",Le,_(e(V)("tags",e(n))),1)):I("",!0)]),o("div",Me,[Re,m(v,{id:"published",name:"status",value:"published",modelValue:e(a).status,"onUpdate:modelValue":t[7]||(t[7]=s=>e(a).status=s),checked:""},{default:g(()=>[y("Published ")]),_:1},8,["modelValue"]),m(v,{id:"draft",name:"status",value:"draft",modelValue:e(a).status,"onUpdate:modelValue":t[8]||(t[8]=s=>e(a).status=s)},{default:g(()=>[y("Draft")]),_:1},8,["modelValue"]),m(v,{id:"archive",name:"status",value:"archive",modelValue:e(a).status,"onUpdate:modelValue":t[9]||(t[9]=s=>e(a).status=s)},{default:g(()=>[y("Archive")]),_:1},8,["modelValue"])]),o("div",Be,[Ne,m(w,{id:"isOnHomepage",name:"isOnHomepage",modelValue:e(a).isOnHomepage,"onUpdate:modelValue":t[10]||(t[10]=s=>e(a).isOnHomepage=s)},null,8,["modelValue"])]),o("div",Fe,[He,m(x,{type:"date",placeholder:"Date",modelValue:e(a).date,"onUpdate:modelValue":t[11]||(t[11]=s=>e(a).date=s)},null,8,["modelValue"])]),o("div",qe,[m(i,{type:"submit",color:"primary",variant:"gradient",class:"ms-auto mb-0"},{default:g(()=>[y(" Submit ")]),_:1})])],32)])])}}};export{at as default};
