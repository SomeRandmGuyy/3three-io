import I from"./ArgonButton.a79d4a57.js";import P from"./ArgonInput.8d0576a6.js";import{y as D,P as J,Q as j,K as k,R as A,S as z,o as _,b as y,e as t,T as x,u as e,c as O,w as C,i as K,l as d,a7 as Q,a8 as G,F as H,k as W,t as E,h as L,U as M}from"./entry.6e39450e.js";import{u as X}from"./UserStore.24d0d5dd.js";import{u as Y}from"./RoleStore.d89f21d5.js";import{u as Z,c as u,r as U,e as ee,m as se,s as te}from"./index.c39e5092.js";import{i as h,g as w}from"./errorHandler.790c67ca.js";import{J as oe}from"./index.aad0ddd6.js";import{d as c}from"./default_avatar.3b6e3719.js";import{C as re}from"./choices.553387e5.js";import"./tslib.es6.4057be70.js";const ae={class:"card shadow-lg mx-4 p-3 mt-4"},le={class:"d-flex justify-content-between px-4 pt-3"},ne=t("h5",{class:"font-weight-bolder mb-0"},"Add User",-1),ie=t("span",{class:"btn-inner--text"},"Back to list",-1),me=[ie],de={class:"mt-4"},ue={class:"d-flex flex-column max-content align-items-center mb-4 mx-4"},ce=["src"],pe={class:"mt-2 d-flex justify-content-center"},fe=t("span",null,[t("i",{class:"fa fa-times"}),L(" Remove ")],-1),_e={for:"imageInput",class:"mb-0"},he={class:"col-12 mt-sm-0"},we=t("label",null,"Name",-1),ge={class:"col-12 mt-sm-0"},be=t("label",null,"Email",-1),ve={class:"col-12 mt-sm-0 mb-3"},ye=t("label",null,"Role",-1),xe=["value"],Ce={class:"col-12 mt-sm-0"},Me=t("label",null,"Password",-1),Ue={class:"col-12 mt-sm-0"},Ve=t("label",null,"Confirm Password",-1),Re={class:"button-row d-flex mt-4"},Pe={__name:"add-user",async setup(Se){let V,R;D(()=>{N("choices-role")});const N=a=>{const s=document.getElementById(a);if(s)return new re(s,{searchEnabled:!1})},g=J(),b=X(),p=Y();p.allRolesList||([V,R]=j(()=>p.getAllRolesList()),await V,R());const i=k(c),f=k(null),o=A({name:"",email:"",role:p.allRolesList[0].id,password:"",passwordConfirm:""}),l=A([]),q=async()=>{const a=f.value.files;if(!a.length)return;const s=new FileReader;s.readAsDataURL(a[0]),s.onload=()=>{i.value=s.result}},B=()=>{i.value=c,f.value=null},F=z(()=>({name:{required:u.withMessage("The name field is required",U)},email:{required:u.withMessage("The email field is required",U),email:u.withMessage("Invalid email format",ee)},password:{required:u.withMessage("The password field is required",U),minLength:u.withMessage("The password must be at least 8 characters",se(8))},passwordConfirm:{sameAs:u.withMessage("Passwords don't match",te(o.password))}})),v=Z(F,o),T=async()=>{if(l.value=[],v.value.$validate(),v.value.$error){const a=JSON.parse(JSON.stringify(v.value.$errors));l.value=[...a]}else try{const a=await b.createUser({email:o.email,name:o.name,password:o.password,passwordConfirm:o.passwordConfirm,role:o.role});if(a.error.value){const s=a.error.value.data.errors[0].detail;throw new Error(s)}else if(i.value===c)M("success","User created successfuly"),g.push({path:"/examples/user-management/list-users"});else{const s=new oe,n=s.deserialize(a.data.value),m=await b.uploadProfileImage(f,n.id),r=s.serialize({stuff:{type:"users",id:n.id,profile_image:m}}),S=await b.updateUser(n.id,r);if(S.error.value){const $=S.error.value.data.errors[0].detail;throw new Error($)}else M("success","User created successfuly"),g.push({path:"/examples/user-management/list-users"})}}catch(a){M("error",a.message)}};return(a,s)=>{const n=I,m=P;return _(),y("div",ae,[t("div",le,[ne,t("button",{onClick:s[0]||(s[0]=x(r=>e(g).push({path:"/examples/user-management/list-users"}),["prevent"])),type:"button",class:"btn base-button btn-icon btn-fab btn-primary btn-sm"},me)]),t("div",de,[t("form",{role:"form",onSubmit:x(T,["prevent"])},[t("div",ue,[t("img",{src:e(i),class:"rounded d-flex justify-content-center argon-image",width:"200",height:"200"},null,8,ce),t("div",pe,[e(i)!==e(c)?(_(),O(n,{key:0,type:"button",onClick:s[1]||(s[1]=x(r=>B(),["prevent"])),class:"btn base-button btn btn-sm btn-danger btn-button mx-2"},{default:C(()=>[fe]),_:1})):K("",!0),d(n,{type:"button",class:"btn base-button btn btn-sm btn-primary btn-button"},{default:C(()=>[t("label",_e,E(e(i)!==e(c)?"Change":"Select image"),1),t("input",{ref_key:"file",ref:f,id:"imageInput",accept:"image/*",type:"file",style:{display:"none"},onChange:s[2]||(s[2]=r=>q())},null,544)]),_:1})])]),t("div",he,[we,d(m,{id:"name",name:"name",class:"multisteps-form__input",type:"text",placeholder:"Name",modelValue:e(o).name,"onUpdate:modelValue":s[3]||(s[3]=r=>e(o).name=r),error:e(h)("name",e(l)),errorMessage:e(w)("name",e(l))},null,8,["modelValue","error","errorMessage"])]),t("div",ge,[be,d(m,{id:"email",name:"email",class:"multisteps-form__input",type:"email",placeholder:"Email",modelValue:e(o).email,"onUpdate:modelValue":s[4]||(s[4]=r=>e(o).email=r),error:e(h)("email",e(l)),errorMessage:e(w)("email",e(l))},null,8,["modelValue","error","errorMessage"])]),t("div",ve,[ye,Q(t("select",{id:"choices-role",class:"form-control",name:"choices-role","onUpdate:modelValue":s[5]||(s[5]=r=>e(o).role=r)},[(_(!0),y(H,null,W(e(p).allRolesList,r=>(_(),y("option",{value:r.id},E(r.name),9,xe))),256))],512),[[G,e(o).role]])]),t("div",Ce,[Me,d(m,{id:"password",name:"password",class:"multisteps-form__input",type:"password",placeholder:"******",modelValue:e(o).password,"onUpdate:modelValue":s[6]||(s[6]=r=>e(o).password=r),error:e(h)("password",e(l)),errorMessage:e(w)("password",e(l))},null,8,["modelValue","error","errorMessage"])]),t("div",Ue,[Ve,d(m,{id:"passwordConfirm",name:"passwordConfirm",class:"multisteps-form__input",type:"password",placeholder:"******",modelValue:e(o).passwordConfirm,"onUpdate:modelValue":s[7]||(s[7]=r=>e(o).passwordConfirm=r),error:e(h)("passwordConfirm",e(l)),errorMessage:e(w)("passwordConfirm",e(l))},null,8,["modelValue","error","errorMessage"])]),t("div",Re,[d(n,{type:"submit",color:"primary",variant:"gradient",class:"ms-auto mb-0"},{default:C(()=>[L(" Submit ")]),_:1})])],32)])])}}};export{Pe as default};
